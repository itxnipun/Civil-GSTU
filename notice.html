<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notice Board - Dept. of Civil Engineering</title>
    <link rel="stylesheet" href="style.css">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="transitions.js"></script>
    <style>
        /* Basic styling for the pinned notice and link */
        .notice-card.pinned {
            border-left: 4px solid #2563eb; /* Blue accent for pinned post */
        }
        .pinned-tag {
            display: inline-block;
            background-color: #2563eb;
            color: white;
            padding: 2px 8px;
            font-size: 0.75rem;
            font-weight: bold;
            border-radius: 9999px;
            margin-right: 8px;
            vertical-align: middle;
        }
        .notice-link {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background-color: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .notice-link:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">
            <img src="images/logo.png" alt="Department of Civil Engineering Logo">
        </a>
        <ul class="nav-links" id="main-nav-links">
             <!-- Populated by auth.js -->
        </ul>

    <button class="hamburger" id="hamburger-button" aria-label="Menu">
        <span class="hamburger-bar"></span>
        <span class="hamburger-bar"></span>
        <span class="hamburger-bar"></span>
    </button>
    </nav>
    <div class="container">
        <div class="page-header">
            <h1>Notice Board</h1>
            <p>The latest news and announcements from the department.</p>
        </div>
        <div class="notice-list" id="notice-list-container">
            <p>Loading notices...</p>
        </div>
    </div>
    <footer class="footer">
        <p>&copy; 2025 Department of Civil Engineering, Gopalganj Science and Technology University</p>
        <p>Gopalganj-8105, Bangladesh</p>
    </footer>

    <script src="auth.js" defer></script>
    <script>
        const noticeContainer = document.getElementById('notice-list-container');
        
        // Assume supabaseClient is initialized in auth.js or elsewhere
        // const { createClient } = supabase
        // const supabaseClient = createClient('YOUR_SUPABASE_URL', 'YOUR_SUPABASE_ANON_KEY')

        // Function to format the date
        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
        }

        async function loadNotices() {
            noticeContainer.innerHTML = ''; // Clear loading message

            // 1. Manually create and add the pinned notice first
            const pinnedNotice = {
                title: 'Updated Syllabus, B.Sc. in Civil Engineering, Gopalganj Science and Technology University',
                // Using a very recent, fixed date to ensure it's clear this is a permanent notice
                created_at: '2025-09-14T00:00:00.000Z', 
                content_html: `<p>The updated syllabus for the B.Sc. in Civil Engineering program is now available. Please review the new course structure and requirements.</p><a href="syllabus_notice.html" class="notice-link">View Updated Syllabus</a>`
            };

            const pinnedNoticeCard = `
                <div class="notice-card pinned">
                    <div class="notice-card-header">
                        <h3><span class="pinned-tag">PINNED</span>${pinnedNotice.title}</h3>
                        <p>Posted on: ${formatDate(pinnedNotice.created_at)}</p>
                    </div>
                    <div class="notice-card-body">
                        ${pinnedNotice.content_html}
                    </div>
                </div>
            `;
            noticeContainer.innerHTML += pinnedNoticeCard;


            // 2. Fetch and display the rest of the notices from Supabase
            const { data, error } = await supabaseClient
                .from('notices')
                .select('*')
                .order('created_at', { ascending: false }); // Newest first

            if (error) {
                console.error('Error fetching notices:', error);
                noticeContainer.innerHTML += '<p>Could not load other notices.</p>';
                return;
            }
            if (data.length === 0) {
                // This message will appear if there are NO other notices
                // console.log('No other notices have been posted yet.'); 
                return;
            }
            
            data.forEach(notice => {
                let contentHTML = '';
                switch (notice.content_type) {
                    case 'text':
                        contentHTML = `<p>${notice.content_data}</p>`;
                        break;
                    case 'image':
                        contentHTML = `<img src="${notice.content_data}" alt="${notice.title}">`;
                        break;
                    case 'pdf':
                        contentHTML = `<a href="${notice.content_data}" class="notice-pdf-link" target="_blank">Download PDF</a>`;
                        break;
                    case 'video':
                        // Assumes a YouTube embed URL
                        contentHTML = `<iframe src="${notice.content_data}" allowfullscreen></iframe>`;
                        break;
                }

                const noticeCard = `
                    <div class="notice-card">
                        <div class="notice-card-header">
                            <h3>${notice.title}</h3>
                            <p>Posted on: ${formatDate(notice.created_at)}</p>
                        </div>
                        <div class="notice-card-body">
                            ${contentHTML}
                        </div>
                    </div>
                `;
                noticeContainer.innerHTML += noticeCard;
            });
        }
        
        // This function will repeatedly check if supabaseClient is available
        // before calling loadNotices(). This prevents the "not defined" error.
        function initializePage() {
            if (typeof supabaseClient !== 'undefined' && supabaseClient) {
                // supabaseClient is ready, we can load the notices
                loadNotices();
            } else {
                // supabaseClient is not ready yet, check again in a moment
                setTimeout(initializePage, 100);
            }
        }

        // Start the process
        initializePage();

    </script>
<script src="fab.js" defer></script>
</body>
</html>

